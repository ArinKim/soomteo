<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ - ë©”ì¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        .container {
            border: 1px solid #ddd;
            border-radius: 15px;
            padding: 40px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #FEE500;
            background-color: #3C1E1E;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .user-info {
            margin: 30px 0;
            padding: 25px;
            background-color: #fafafa;
            border-radius: 10px;
            border: 2px solid #FEE500;
        }
        .user-info h3 {
            margin-bottom: 20px;
            color: #3C1E1E;
        }
        .user-info p {
            margin: 12px 0;
            font-size: 16px;
            text-align: left;
            padding: 8px;
            background-color: #fff;
            border-radius: 5px;
        }
        .profile-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 15px 0;
            border: 3px solid #FEE500;
        }
        .db-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 8px;
            font-size: 14px;
            color: #2e7d32;
        }
        #logout-btn {
            background-color: #FEE500;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
        }
        #logout-btn:hover {
            background-color: #FDD835;
            transform: translateY(-2px);
        }
        #logout-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ‰ ë¡œê·¸ì¸ ì™„ë£Œ!</h1>

    <div class="user-info">
        <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>

        <div th:if="${profileImage}">
            <img th:src="${profileImage}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image">
        </div>

        <p><strong>ğŸ†” ì‚¬ìš©ì ID:</strong> <span th:text="${userId}">-</span></p>
        <p><strong>ğŸ”‘ ì¹´ì¹´ì˜¤ ID:</strong> <span th:text="${kakaoId}">-</span></p>
        <p><strong>ğŸ‘¨â€ğŸ’¼ ë‹‰ë„¤ì„:</strong> <span th:text="${nickname}">-</span></p>
        <p><strong>ğŸ“§ ì´ë©”ì¼:</strong> <span th:text="${email}">-</span></p>
        <p><strong>ğŸ“… ì—°ë ¹ëŒ€:</strong> <span th:text="${ageRange}">-</span></p>
        <p><strong>âš§ ì„±ë³„:</strong> <span th:text="${gender}">-</span></p>

        <div class="db-info">
            âœ… ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ì •ë³´ì…ë‹ˆë‹¤
        </div>
    </div>

    <button id="logout-btn" onclick="logout()">
        ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ
    </button>

    <div id="message" class="message" style="display: none;"></div>
</div>

<script>
    function logout() {
        const token = getCookie('kakao_access_token');

        if (!token) {
            showMessage('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.', 'error');
            setTimeout(() => {
                window.location.href = '/api/v1/auth/kakao/login';
            }, 1000);
            return;
        }

        const btn = document.getElementById('logout-btn');
        btn.disabled = true;
        btn.innerText = 'ë¡œê·¸ì•„ì›ƒ ì¤‘...';

        fetch('/api/v1/auth/kakao/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'accessToken=' + encodeURIComponent(token)
        })
            .then(response => response.text())
            .then(data => {
                console.log('ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ:', data);
                showMessage(data, 'success');

                setTimeout(() => {
                    window.location.href = '/api/v1/auth/kakao/login';
                }, 1000);
            })
            .catch(error => {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                showMessage('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ' + error.message, 'error');
                btn.disabled = false;
                btn.innerText = 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ';
            });
    }

    function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.innerText = text;
        messageDiv.className = 'message ' + type;
        messageDiv.style.display = 'block';
    }

    function getCookie(name) {
        const parts = document.cookie.split(name + '=');
        if (parts.length === 2) {
            return parts[1].split(';')[0];
        }
        return null;
    }
</script>
</body>
</html>